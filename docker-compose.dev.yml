version: '3.7'
services:
  #################
  ### Front-end ###
  #################

  client:
    build:
      context: ./packages/client
      dockerfile: Dockerfile.dev
    volumes:
      - ./packages/client:/app
      - /app/.next
      - /app/node_modules

  ################
  ### Back-end ###
  ################

  server:
    build:
      context: ./packages/server
      dockerfile: Dockerfile.dev
    volumes:
      - ./packages/server:/app
      - /app/dist
      - /app/node_modules

  ######################
  ### Infrastructure ###
  ######################

  caddy:
    build:
      context: ./packages/caddy/dns/local
      dockerfile: Dockerfile
    volumes:
      - ./packages/caddy/dns/local/Caddyfile:/etc/caddy/Caddyfile:ro

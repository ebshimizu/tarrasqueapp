version: '3.7'
services:
  #################
  ### Front-end ###
  #################

  client:
    build:
      context: ./packages/client
      dockerfile: Dockerfile.prod

  ################
  ### Back-end ###
  ################

  server:
    build:
      context: ./packages/server
      dockerfile: Dockerfile.prod

  ######################
  ### Infrastructure ###
  ######################

  caddy:
    build:
      context: ./caddy/dns/${CADDY_DNS_METHOD}
      dockerfile: Dockerfile
    volumes:
      - etc-caddy:/etc/caddy

volumes:
  etc-caddy:

x-mutagen:
  sync:
    etc-caddy:
      alpha: './caddy/dns/${CADDY_DNS_METHOD}'
      beta: 'volume://etc-caddy'

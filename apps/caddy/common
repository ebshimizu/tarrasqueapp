encode zstd gzip
request_header -Referer -Server

header {
  -Server
  -X-Powered-By
}

handle_errors {
  rewrite * /maintenance.html
  file_server
}

log {
  output file /var/log/access.log
  format filter {
    wrap console {
      time_format iso8601
    }
    fields {
      request>headers>Authorization delete
      request>headers>Cookie delete
    }
  }
}

handle {
  reverse_proxy client:3000
}

handle /images/* {
  header Cross-Origin-Resource-Policy "cross-origin"
  reverse_proxy client:3000
}

@api path /api /api/*
handle @api {
  reverse_proxy server:3001
}

@socket path /socket.io /socket.io/*
handle @socket {
  reverse_proxy server:3001
}

encode zstd gzip
request_header -Referer -Server

header {
  -Server
  -X-Powered-By
}

handle_errors {
  rewrite * /maintenance.html
  file_server
}

log {
  output file /var/log/access.log
  format filter {
    wrap console {
      time_format iso8601
    }
    fields {
      request>headers>Authorization delete
      request>headers>Cookie delete
    }
  }
}

# Client
@client path {$BASE_PATH} {$BASE_PATH}/*
handle @client {
  reverse_proxy client:3000
}

# Server
@server path {$BASE_PATH}/api {$BASE_PATH}/api/*
handle @server {
  reverse_proxy server:3001
}

# Socket.IO
@socket.io path {$BASE_PATH}/socket.io {$BASE_PATH}/socket.io/*
handle @socket.io {
  reverse_proxy server:3001
}

# Plugins
@plugins path {$BASE_PATH}/plugins {$BASE_PATH}/plugins/*
handle @plugins {
  file_server browse
}

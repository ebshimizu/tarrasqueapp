FROM node:18-slim

RUN apt-get update && apt-get -y install openssl

COPY --from=mwader/static-ffmpeg:4.4.1 /ffmpeg /usr/local/bin/
COPY --from=mwader/static-ffmpeg:4.4.1 /ffprobe /usr/local/bin/
COPY --from=mwader/static-ffmpeg:4.4.1 /qt-faststart /usr/local/bin/

WORKDIR /app

COPY package.json yarn.lock ./
COPY prisma prisma

RUN yarn install --pure-lockfile

COPY . .

RUN yarn prisma generate

CMD yarn start:dev
